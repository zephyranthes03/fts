
<!doctype html>
<html lang="ko">
<head>
<script type="text/javascript" src="https://static.nid.naver.com/js/naverLogin_implicit-1.0.3.js" charset="utf-8"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
</head>
<body>
<script type="text/javascript">
  var naver_id_login = new naver_id_login("{{ CLIENT_ID }}", 
                                            "{{ CALLBACK_URL }}");

  // 접근 토큰 값 출력
  // alert(naver_id_login.oauthParams.access_token);
  // console.log(naver_id_login.oauthParams.access_token);
  // 네이버 사용자 프로필 조회
  naver_id_login.get_naver_userprofile("naverSignInCallback()");
  // 네이버 사용자 프로필 조회 이후 프로필 정보를 처리할 callback function
  
  function naverSignInCallback() {
    // alert(naver_id_login.getProfileData('id'));
    // alert(naver_id_login.getProfileData('email'));
    // alert(naver_id_login.getProfileData('name'));
    // alert(naver_id_login.getProfileData('age'));
    // alert(naver_id_login.getProfileData('gender'));

    // alert(naver_id_login.getProfileData('birthyear')); // undefineded
    // alert(naver_id_login.getProfileData('nickname'));
    // alert(naver_id_login.getProfileData('birthday'));
    // alert(naver_id_login.getProfileData('profile_image'));
    // alert(naver_id_login.getProfileData('mobile')); // undefineded

    id = naver_id_login.getProfileData('id')
    email = naver_id_login.getProfileData('email')
    username = naver_id_login.getProfileData('name')
    nickname = naver_id_login.getProfileData('nickname')
    age = naver_id_login.getProfileData('age')
    gender = naver_id_login.getProfileData('gender') === "M" ? "male" : "feMale"

    const url = "https://imgroo.kr/user/social_email";
    const data = JSON.stringify( {
        email : email,
        login_type : 'naver',
        extra_data : {
                        id : id,
                        username : username,
                        nickname : nickname,
                        age : age,
                        gender : gender
        },
        access_token: naver_id_login.oauthParams.access_token,
        refresh_token: ''

      });
      console.log(data);
      console.log(naver_id_login.oauthParams.refresh_token);
      $.ajax({
      url: url,
      crossDomain: true,
      method: 'post',
      headers: {
        'accept': 'application/json'
      },
      contentType: 'application/json',
      // data: '{\n  "email": "realizer25@naver.com",\n  "login_type": "naver",\n  "extra_data": {\n    "id": "id11111111111111111111",\n    "username": "Yongjin Chong",\n    "nickname": "john_doe111",\n    "gender": "male",\n    "age": "30-39"\n  },\n  "access_token": "token_value",\n  "refresh_token": "refresh_token_value"\n}',
      data: data
    }).done(function(response) {
      console.log(response);
    });    
    // console.log(data);
    // $.post(url, 
    //     crossDomain: true,
    //     headers: { 'accept': 'application/json'},

    //     data, function(data,status) {
    //     console.log(`${data} and status is ${status}`)
    // });

    // get_url = "http://localhost:8001/user/email/john_doe1@gmail.com"
    // $.get(get_url, data, function(status) {
    //     console.log(`status is ${status}`)
    // });    
    console.log("end of naverSignInCallback()");
  }

</script>
</body>
</html>