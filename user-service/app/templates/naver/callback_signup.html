
<!doctype html>
<html lang="ko">
<head>
<script type="text/javascript" src="https://static.nid.naver.com/js/naverLogin_implicit-1.0.3.js" charset="utf-8"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
</head>
<body>
<div id="output"></div>
<script type="text/javascript">
  var naver_id_login = new naver_id_login("{{ CLIENT_ID }}", 
                                            "{{ CALLBACK_URL }}");

  // 접근 토큰 값 출력
  // alert(naver_id_login.oauthParams.access_token);
  // console.log(naver_id_login.oauthParams.access_token);
  // 네이버 사용자 프로필 조회
  naver_id_login.get_naver_userprofile("naverSignInCallback()");
  // 네이버 사용자 프로필 조회 이후 프로필 정보를 처리할 callback function
  
  function naverSignInCallback() {
    // alert(naver_id_login.getProfileData('id'));
    // alert(naver_id_login.getProfileData('email'));
    // alert(naver_id_login.getProfileData('name'));
    // alert(naver_id_login.getProfileData('age'));
    // alert(naver_id_login.getProfileData('gender'));

    // alert(naver_id_login.getProfileData('birthyear')); // undefineded
    // alert(naver_id_login.getProfileData('nickname'));
    // alert(naver_id_login.getProfileData('birthday'));
    // alert(naver_id_login.getProfileData('profile_image'));
    // alert(naver_id_login.getProfileData('mobile')); // undefineded

    id = naver_id_login.getProfileData('id')
    email = naver_id_login.getProfileData('email')
    username = naver_id_login.getProfileData('name')
    nickname = naver_id_login.getProfileData('nickname')
    age = naver_id_login.getProfileData('age')
    gender = naver_id_login.getProfileData('gender') === "M" ? "male" : "feMale"

    const url = "https://imgroo.kr/user/social_signup";
    const json_data = JSON.stringify( {
        email : email,
        login_type : 'naver',
        extra_data : {
                        id : id,
                        username : username,
                        nickname : nickname,
                        age : age,
                        gender : gender
        },
        access_token: naver_id_login.oauthParams.access_token,
        refresh_token: ''

      });
      $.ajax({
      url: url,
      crossDomain: true,
      method: 'post',
      headers: {
        'accept': 'application/json'
      },
      contentType: 'application/json',
      data: json_data
    }).done(function(response) {
      var output = document.getElementById("output");
      output.innerHTML = JSON.stringify(response);      
      console.log(response);
      console.log("success");
    });    

    console.log("end of naverSignInCallback()");
  }

</script>
</body>
</html>